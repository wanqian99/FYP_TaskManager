{"version":3,"sources":["Canvas.tsx"],"names":["width","screenWidth","height","screenHeight","Dimensions","get","generateSVGPath","path","simplifyOptions","simplifyPaths","amount","roundPoints","generateSVGPaths","paths","map","i","data","reduce","acc","Canvas","color","DEFAULT_BRUSH_COLOR","thickness","DEFAULT_THICKNESS","opacity","DEFAULT_OPACITY","initialPaths","style","onPathsChange","eraserSize","DEFAULT_ERASER_SIZE","tool","DEFAULT_TOOL","combineWithLatestPath","enabled","ref","simplifyCurrentPath","setPaths","setPath","canvasContainerStyles","styles","canvas","addPointToPath","x","y","prev","Math","floor","undo","list","p","index","length","slice","clear","getPaths","addPath","newPath","getSvg","serializePath","d","stroke","strokeWidth","strokeOpacity","separatePaths","innerPath","combinedPath","join","serializedPaths","combine","panGesture","Gesture","Pan","onChange","DrawingTool","Brush","Eraser","prevPaths","filteredDataPaths","acc2","closeToPath","some","x1","y1","abs","onBegin","onEnd","newSVGPath","lastPath","minPointers","minDistance","averageTouches","hitSlop","top","left","shouldCancelWhenOutside","SVGRenderer","StyleSheet","create","backgroundColor","canvasOverlay","position"],"mappings":"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","sourcesContent":["import React, {\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport {\n  Animated,\n  Dimensions,\n  StyleProp,\n  StyleSheet,\n  View,\n  ViewStyle,\n} from 'react-native';\nimport {\n  Gesture,\n  GestureDetector,\n  GestureHandlerRootView,\n} from 'react-native-gesture-handler';\n\nimport {\n  DEFAULT_BRUSH_COLOR,\n  DEFAULT_ERASER_SIZE,\n  DEFAULT_OPACITY,\n  DEFAULT_THICKNESS,\n  DEFAULT_TOOL,\n} from './constants';\nimport { DrawingTool, PathDataType, PathType } from './types';\nimport { createSVGPath } from './utils';\nimport SVGRenderer from './renderer/SVGRenderer';\nimport RendererHelper from './renderer/RendererHelper';\n\nconst { width: screenWidth, height: screenHeight } = Dimensions.get('window');\n\nexport interface CanvasProps {\n  /**\n   * Color of the brush strokes\n   * @default DEFAULT_BRUSH_COLOR\n   */\n  color?: string;\n\n  /**\n   * Thickness of the brush strokes\n   * @default DEFAULT_THICKNESS\n   */\n  thickness?: number;\n\n  /**\n   * Opacity of the brush strokes\n   * @default DEFAULT_OPACITY\n   */\n  opacity?: number;\n\n  /**\n   * Paths to be already drawn\n   * @default []\n   */\n  initialPaths?: PathType[];\n\n  /**\n   * Height of the canvas\n   */\n  height?: number;\n\n  /**\n   * Width of the canvas\n   */\n  width?: number;\n\n  /**\n   * Override the style of the container of the canvas\n   */\n  style?: StyleProp<ViewStyle>;\n\n  /**\n   * Callback function when paths change\n   */\n  onPathsChange?: (paths: PathType[]) => any;\n\n  /**\n   * SVG simplification options\n   */\n  simplifyOptions?: SimplifyOptions;\n\n  /**\n   * Width of eraser (to compensate for path simplification)\n   * @default DEFAULT_ERASER_SIZE\n   */\n  eraserSize?: number;\n\n  /**\n   * Initial tool of the canvas\n   * @default DEFAULT_TOOL\n   */\n  tool?: DrawingTool;\n\n  /**\n   * Combine current path with the last path if it's the same color,\n   * thickness, and opacity.\n   *\n   * **Note**: changing this value while drawing will only be effective\n   * on the next change to opacity, thickness, or color change\n   * @default false\n   */\n  combineWithLatestPath?: boolean;\n\n  /**\n   * Allows for the canvas to be drawn on, put to false if you want to disable/lock\n   * the canvas\n   * @default true\n   */\n  enabled?: boolean;\n}\n\nexport interface SimplifyOptions {\n  /**\n   * Enable SVG path simplification on paths, except the one currently being drawn\n   */\n  simplifyPaths?: boolean;\n\n  /**\n   * Enable SVG path simplification on the stroke being drawn\n   */\n  simplifyCurrentPath?: boolean;\n\n  /**\n   * Amount of simplification to apply\n   */\n  amount?: number;\n\n  /**\n   * Ignore fractional part in the points. Improves performance\n   */\n  roundPoints?: boolean;\n}\n\nexport interface CanvasRef {\n  /**\n   * Undo last brush stroke\n   */\n  undo: () => void;\n\n  /**\n   * Removes all brush strokes\n   */\n  clear: () => void;\n\n  /**\n   * Get brush strokes data\n   */\n  getPaths: () => PathType[];\n\n  /**\n   * Append a path to the current drawing paths\n   * @param path Path to append/draw\n   */\n  addPath: (path: PathType) => void;\n\n  /**\n   * Get SVG path string of the drawing\n   */\n  getSvg: () => string;\n}\n\n/**\n * Generate SVG path string. Helper method for createSVGPath\n *\n * @param paths SVG path data\n * @param simplifyOptions Simplification options for the SVG drawing simplification\n * @returns SVG path strings\n */\nconst generateSVGPath = (\n  path: PathDataType,\n  simplifyOptions: SimplifyOptions\n) =>\n  createSVGPath(\n    path,\n    simplifyOptions.simplifyPaths ? simplifyOptions.amount! : 0,\n    simplifyOptions.roundPoints!\n  );\n\n/**\n * Generate multiple SVG path strings. If the path string is already defined, do not create a new one.\n *\n * @param paths SVG data paths\n * @param simplifyOptions Simplification options for the SVG drawing simplification\n * @returns An array of SVG path strings\n */\nconst generateSVGPaths = (\n  paths: PathType[],\n  simplifyOptions: SimplifyOptions\n) =>\n  paths.map((i) => ({\n    ...i,\n    path: i.path\n      ? i.path\n      : i.data.reduce(\n          (acc: string[], data) => [\n            ...acc,\n            generateSVGPath(data, simplifyOptions),\n          ],\n          []\n        ),\n  }));\n\nconst Canvas = forwardRef<CanvasRef, CanvasProps>(\n  (\n    {\n      color = DEFAULT_BRUSH_COLOR,\n      thickness = DEFAULT_THICKNESS,\n      opacity = DEFAULT_OPACITY,\n      initialPaths = [],\n      style,\n      height = screenHeight - 80,\n      width = screenWidth,\n      simplifyOptions = {},\n      onPathsChange,\n      eraserSize = DEFAULT_ERASER_SIZE,\n      tool = DEFAULT_TOOL,\n      combineWithLatestPath = false,\n      enabled = true,\n    },\n    ref\n  ) => {\n    simplifyOptions = {\n      simplifyPaths: true,\n      simplifyCurrentPath: false,\n      amount: 15,\n      roundPoints: true,\n      ...simplifyOptions,\n    };\n\n    const [paths, setPaths] = useState<PathType[]>(\n      generateSVGPaths(initialPaths, simplifyOptions)\n    );\n    const [path, setPath] = useState<PathDataType>([]);\n\n    const canvasContainerStyles = [\n      styles.canvas,\n      {\n        height,\n        width,\n      },\n      style,\n    ];\n\n    const addPointToPath = (x: number, y: number) => {\n      setPath((prev) => [\n        ...prev,\n        [\n          simplifyOptions.roundPoints ? Math.floor(x) : x,\n          simplifyOptions.roundPoints ? Math.floor(y) : y,\n        ],\n      ]);\n    };\n\n    const undo = () => {\n      setPaths((list) =>\n        list.reduce((acc: PathType[], p, index) => {\n          if (index === list.length - 1) {\n            if (p.data.length > 1) {\n              return [\n                ...acc,\n                {\n                  ...p,\n                  data: p.data.slice(0, -1),\n                  path: p.path!.slice(0, -1),\n                },\n              ];\n            }\n            return acc;\n          }\n          return [...acc, p];\n        }, [])\n      );\n    };\n\n    const clear = () => {\n      setPaths([]);\n      setPath([]);\n    };\n\n    const getPaths = () => paths;\n\n    const addPath = (newPath: PathType) =>\n      setPaths((prev) => [...prev, newPath]);\n\n    const getSvg = () => {\n      const serializePath = (\n        d: string,\n        stroke: string,\n        strokeWidth: number,\n        strokeOpacity: number\n      ) =>\n        `<path d=\"${d}\" stroke=\"${stroke}\" stroke-width=\"${strokeWidth}\" opacity=\"${strokeOpacity}\" stroke-linecap=\"round\" stroke-linejoin=\"round\" fill=\"none\"/>`;\n\n      const separatePaths = (p: PathType) =>\n        p.path!.reduce(\n          (acc, innerPath) =>\n            `${acc}${serializePath(\n              innerPath,\n              p.color,\n              p.thickness,\n              p.opacity\n            )}`,\n          ''\n        );\n\n      const combinedPath = (p: PathType) =>\n        `${serializePath(p.path!.join(' '), p.color, p.thickness, p.opacity)}`;\n\n      const serializedPaths = paths.reduce(\n        (acc, p) => `${acc}${p.combine ? combinedPath(p) : separatePaths(p)}`,\n        ''\n      );\n\n      return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\">${serializedPaths}</svg>`;\n    };\n\n    useImperativeHandle(ref, () => ({\n      undo,\n      clear,\n      getPaths,\n      addPath,\n      getSvg,\n    }));\n\n    useEffect(\n      () => onPathsChange && onPathsChange(paths),\n      [paths, onPathsChange]\n    );\n\n    const panGesture = Gesture.Pan()\n      .onChange(({ x, y }) => {\n        switch (tool) {\n          case DrawingTool.Brush:\n            addPointToPath(x, y);\n            break;\n          case DrawingTool.Eraser:\n            setPaths((prevPaths) =>\n              prevPaths.reduce((acc: PathType[], p) => {\n                const filteredDataPaths = p.data.reduce(\n                  (\n                    acc2: { data: PathDataType[]; path: string[] },\n                    data,\n                    index\n                  ) => {\n                    const closeToPath = data.some(\n                      ([x1, y1]) =>\n                        Math.abs(x1 - x) < p.thickness + eraserSize &&\n                        Math.abs(y1 - y) < p.thickness + eraserSize\n                    );\n\n                    // If point close to path, don't include it\n                    if (closeToPath) {\n                      return acc2;\n                    }\n\n                    return {\n                      data: [...acc2.data, data],\n                      path: [...acc2.path, p.path![index]],\n                    };\n                  },\n                  { data: [], path: [] }\n                );\n\n                if (filteredDataPaths.data.length > 0) {\n                  return [...acc, { ...p, ...filteredDataPaths }];\n                }\n\n                return acc;\n              }, [])\n            );\n            break;\n        }\n      })\n      .onBegin(({ x, y }) => {\n        if (tool === DrawingTool.Brush) {\n          addPointToPath(x, y);\n        }\n      })\n      .onEnd(() => {\n        if (tool === DrawingTool.Brush) {\n          setPaths((prev) => {\n            const newSVGPath = generateSVGPath(path, simplifyOptions);\n\n            if (prev.length === 0) {\n              return [\n                {\n                  color,\n                  path: [newSVGPath],\n                  data: [path],\n                  thickness,\n                  opacity,\n                  combine: combineWithLatestPath,\n                },\n              ];\n            }\n\n            const lastPath = prev[prev.length - 1];\n\n            // Check if the last path has the same properties\n            if (\n              lastPath.color === color &&\n              lastPath.thickness === thickness &&\n              lastPath.opacity === opacity\n            ) {\n              lastPath.path = [...lastPath.path!, newSVGPath];\n              lastPath.data = [...lastPath.data, path];\n\n              return [...prev.slice(0, -1), lastPath];\n            }\n\n            return [\n              ...prev,\n              {\n                color,\n                path: [newSVGPath],\n                data: [path],\n                thickness,\n                opacity,\n                combine: combineWithLatestPath,\n              },\n            ];\n          });\n          setPath([]);\n        }\n      })\n      .minPointers(1)\n      .minDistance(0)\n      .averageTouches(false)\n      .hitSlop({\n        height,\n        width,\n        top: 0,\n        left: 0,\n      })\n      .shouldCancelWhenOutside(true)\n      .enabled(enabled);\n\n    return (\n      <GestureHandlerRootView style={canvasContainerStyles}>\n        <Animated.View>\n          <GestureDetector gesture={panGesture}>\n            <View>\n              <RendererHelper\n                currentColor={color}\n                currentOpacity={opacity}\n                currentPath={path}\n                currentThickness={thickness}\n                currentPathTolerance={\n                  simplifyOptions.simplifyCurrentPath\n                    ? simplifyOptions.amount!\n                    : 0\n                }\n                roundPoints={simplifyOptions.roundPoints!}\n                paths={paths}\n                height={height}\n                width={width}\n                Renderer={SVGRenderer}\n              />\n            </View>\n          </GestureDetector>\n        </Animated.View>\n      </GestureHandlerRootView>\n    );\n  }\n);\n\nconst styles = StyleSheet.create({\n  canvas: {\n    backgroundColor: 'white',\n  },\n  canvasOverlay: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    backgroundColor: '#000000',\n  },\n});\n\nexport default Canvas;\n"]}